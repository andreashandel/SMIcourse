<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Andreas Handel" />


<title>A few simple models</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="icon" type="image/png" href="media/smi_logo.png" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="media/SMICourse_style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">SMI Course</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General Information
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./Course_Syllabus.html">Syllabus</a>
    </li>
    <li>
      <a href="./Course_Schedule.html">Schedule</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Modules
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">1. Coures and Tools Introduction</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./1a_Course_Introduction.html">1a. Course introduction</a>
        </li>
        <li>
          <a href="./1b_R_and_RStudio.html">1b. R and Rstudio</a>
        </li>
        <li>
          <a href="./1c_DSAIRM.html">1c. DSAIRM</a>
        </li>
        <li>
          <a href="./1d_Further_Tools.html">1d. Further Tools</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">2. Introduction to Immunology</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./2a_Introduction_to_Immunology.html">2a. Introduction to Immunology</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">3. Introduction to Simulation Modeling</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./3a_Introduction_to_Modeling.html">3a. Introduction to Simulation Modeling</a>
        </li>
        <li>
          <a href="./3b_Model_Thinking.html">3b. Model Thinking</a>
        </li>
        <li>
          <a href="./3c_Simple_Models.html">3c. A few simple models</a>
        </li>
        <li>
          <a href="./3d_Model_Types.html">3d. Types of simulation models</a>
        </li>
        <li>
          <a href="./3e_Exercises.html">3e. Exercises</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">4. Viral Infections and Immunology</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./4a_Viral_Infections_Immunology.html">4a. Viral Infections and Immunology</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">5. Using Simulation Models</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./5a_Uses_of_Simulation_Models.html">5a. Uses of Simulation Models</a>
        </li>
        <li>
          <a href="./5b_Models_for_Exploration.html">5b. Models for Exploration</a>
        </li>
        <li>
          <a href="./5c_Models_for_Prediction.html">5c. Models for Prediction</a>
        </li>
        <li>
          <a href="./5d_Model_Fitting.html">5d. Models for Fitting</a>
        </li>
        <li>
          <a href="./5e_Exercises.html">5e. Exercises</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">6. Complex Pathogen Life cycles and Immunology</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./6a_Complex_Pathogens_Immunology.html">6a. Complex Pathogen Life cycles and Immunology</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">7. What influences model results</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./7a_What_influences_model_results.html">7a. What influences model results</a>
        </li>
        <li>
          <a href="./7b_Structural_Uncertainty.html">7b. Structural Uncertainty</a>
        </li>
        <li>
          <a href="./7c_Parameter_Uncertainty.html">7c. Parameter Uncertainty</a>
        </li>
        <li>
          <a href="./7d_Model_Stochasticity.html">7d. Model Stochasticity</a>
        </li>
        <li>
          <a href="./7e_Exercises.html">7e. Exercises</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">8. How to build and assess models</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./8a_Model_Building_Assessment.html">8a. Model building and assessment overview</a>
        </li>
        <li>
          <a href="./8b_Building_Models.html">8b. How to build good models</a>
        </li>
        <li>
          <a href="./8c_Assessing_Models.html">8c. Assessing published models</a>
        </li>
      </ul>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">9. Various Topics</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./9a_Host_Genetics_Immunity.html">9a. Host Genetics and Immunity</a>
        </li>
        <li>
          <a href="./9b_Multiscale_Models.html">9b. Multiscale Models</a>
        </li>
        <li>
          <a href="./9c_DSAIRM_Code_Exploration.html">9c. DSAIRM code exploration</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
<li>
  <a href="./Project_Information.html">Project</a>
</li>
<li>
  <a href="./Course_Communication.html">Communication</a>
</li>
<li>
  <a href="./Course_Glossary.html">Glossary</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./Course_Resources.html">Course Resources</a>
    </li>
    <li>
      <a href="./General_Resources.html">General Resources</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/andreashandel/SMIcourse">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">A few simple models</h1>
<h4 class="author">Andreas Handel</h4>
<h4 class="date">2021-03-31 18:28:03</h4>

</div>


<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This document provides an introduction to a few basic models that describe within-host infection dynamics.</p>
</div>
<div id="learning-objectives" class="section level1">
<h1>Learning Objectives</h1>
<ul>
<li>Be familiar with a few basic within-host models.</li>
</ul>
</div>
<div id="slides" class="section level1">
<h1>Slides</h1>
<p>We will discuss this topic in one of the zoom sessions. The slides for that session <a href="./slides/Simple_Models_Slides.html">can be found here.</a></p>
</div>
<div id="reading" class="section level1">
<h1>Reading</h1>
<p><em>This material overlaps with the slides.</em></p>
<div id="a-very-simple-compartmental-model" class="section level2">
<h2>A very simple compartmental model</h2>
<p>Consider a single population of entities (pathogens/immune cells/humans/animals) that grow or die. We want to model this population. We’ll implement the model as a discrete time equation, given by:</p>
<p><span class="math display">\[
P_{t+dt} = P_t + dt ( g P_t - d_P P_t )
\]</span></p>
<p><span class="math inline">\(P_t\)</span> are the number of pathogens in the population at current time <span class="math inline">\(t\)</span>, <span class="math inline">\(dt\)</span> is some time step and <span class="math inline">\(P_{t+dt}\)</span> is the number of pathogens in the future after that time step has been taken. The processes/mechanisms modeled are growth at rate <span class="math inline">\(g\)</span> and death at rate <span class="math inline">\(d_P\)</span>.</p>
<p>Try to “simulate” the model for yourself, either in our head or with pencil or paper. Assume we start with <span class="math inline">\(B_0=100\)</span> bacteria at t=0, go in steps of hours (<span class="math inline">\(dt=1h\)</span>) and birth rate is <span class="math inline">\(g=4\)</span> per hour and death is <span class="math inline">\(d_P=2\)</span> per hour. How many bacteria are there after 1,2,3… hours?</p>
</div>
<div id="from-words-to-models" class="section level2">
<h2>From words to models</h2>
<p>When you start building a new model, it is important to carefully go back and forth between your verbal description of the system you want to model and your actual model. You will soon realize that the mapping from words to specific models/equations requires some thought (we’ll visit this topic in detail later). For instance here are two models that also have the processes of pathogen growth and birth, but the specific way those processes are implemented differs from the above model.</p>
<p>Variant 1: <span class="math display">\[
P_{t+dt} = P_t + dt ( g - d_P P_t )
\]</span></p>
<p>Variant 2: <span class="math display">\[
P_{t+dt} = P_t + dt ( g P_t - d_P)
\]</span> In variant 1, the term describing growth/increase of pathogens is changed from one that is proportional to pathogen load (<span class="math inline">\(gP_t\)</span>) to one that occurs at a fixed rate (<span class="math inline">\(g\)</span>). Those represent two different biological mechanisms. The original one mimics exponential growth one would see from e.g. a population of dividing bacteria. The more bacteria there are, the more new ones are produced, and that happens at some given rate. The second model describes the process of a constant production of new entities. This might for instance be a good choice if <span class="math inline">\(P\)</span> were a population of immune cells which are - in the absence of an infection - produced by the body at some constant rate, independent of the number of cells that are present. Thus, both the original model and variant 1 are biologically reasonable models and one should choose the formulation that better mimics the system one wants to study.</p>
<p>Things are a bit different for model variant 2. Here the death/removal term is changed. In the original model, <span class="math inline">\(P\)</span> is removed at some per-capita rate <span class="math inline">\(d_P\)</span> so the total removal is <span class="math inline">\(d_PP_t\)</span>. In variant 2, the removal occurs at a fixed rate <span class="math inline">\(d_P\)</span> and is independent of <span class="math inline">\(P_t\)</span>. This model variant is in fact a bad model and can never represent any real biological system. Think about it for a moment why that is so. Got it? The problem is that in this model, if there are no <span class="math inline">\(P\)</span> around, i.e. <span class="math inline">\(P_t=0\)</span> at some point, removal still occurs at rate <span class="math inline">\(d_P\)</span>. Obviously, if no <span class="math inline">\(P\)</span> is left, none of them can leave/die. Thus, there is no biological scenario for which this model makes sense, it’s simply a wrong model. This is a general feature you should keep in mind - and a mistake I see novices make often. Any outflow, i.e. a term with a minus-sign on the right side of the equation, needs to be multiplied by the compartment that it is tracking (e.g. here <span class="math inline">\(P\)</span>), otherwise you will have the potential problem of removing things from an empty compartment.</p>
</div>
<div id="model-diagrams" class="section level2">
<h2>Model diagrams</h2>
<p>When you start out building models, reading and writing equations might not come easy initially. It is therefore a good idea to also use diagrams. In fact, diagrams are always a great tool, no matter how advanced you are in our modeling career. In a diagram for the types of models we discuss here, each component that is tracked is represented by a box, the different processes are represented by arrows. For the very simple model above, the diagram looks like this:</p>
<p><img src="media/nri_review_onecompmodel.png" width="80%" /></p>
</div>
<div id="exploring-the-simple-model" class="section level2">
<h2>Exploring the simple model</h2>
<p>Above, I suggested you explore what the model will produce for some choices of <span class="math inline">\(g\)</span> and <span class="math inline">\(d_P\)</span>. More generally, can you figure out what kind of results you can get from this model for different values of the growth and death parameters, <span class="math inline">\(g\)</span> and <span class="math inline">\(d_P\)</span>? You can try thinking through it (which is possible for simple models like this one, but usually doesn’t work for complex models). You could also try different combinations by hand, but that gets tedious. Finally, you can explore the model on a computer. In this case, the model is very simple and the following lines of <code>R</code> code can let you run it.</p>
<pre class="r"><code>#specify values for the model parameters and the starting numbers for P
g = 10
dP = 5
P0 = 1
#specify time for which we want to run the model and time steps
dt=0.1
tmax=20
time = seq(0,tmax,by=dt)
# create a vector of the right length and fill it with 0s
# this vector will contain P at every time step 
Pvec = rep(0,length(time))
Pvec[1] = P0 #enter the starting value
#run the model by stepping forward in time
for (i in 1:(length(time)-1)) {Pvec[i+1]=Pvec[i]+dt*(g*Pvec[i]-dP*Pvec[i])}
plot(time,Pvec,log=&quot;y&quot;)</code></pre>
<p><img src="3c_Simple_Models_files/figure-html/simplemodelcode-1.png" width="672" /></p>
<p>I added comments to the code so it’s hopefully clear what is happening. That is always a good idea! In my opinion, at least 50% of code should be comments. Your collaborators and your future self will thank you. It might seem excessive when you start with simple code, but it soon gets complex and without comments you will have no idea what you did if you look at your own code a few weeks later, let alone someone else’s.</p>
<p>Try different values for <span class="math inline">\(g\)</span> and <span class="math inline">\(d_P\)</span> and look at the different patterns you can get. You should find that only 3 patterns are possible. If <span class="math inline">\(g&lt;d_P\)</span>, <span class="math inline">\(P\)</span> will go to zero from its starting value. That’s a reasonable biological behavior. If <span class="math inline">\(g=d_P\)</span>, <span class="math inline">\(P\)</span> will stay at its starting value. That’s somewhat reasonable, however in the real world, things are never exactly equal, so this model behaviour is not very robust. If <span class="math inline">\(g&gt;d_P\)</span> you will see that <span class="math inline">\(P\)</span> grows exponentially forever. While exponential growth is reasonable and often seen, it does not go on forever. Eventually, something slows down the growth. Usually, it is some resource limitation (no more food, no more space, etc.). To make the model more realistic, let’s implement such saturating growth.</p>
</div>
<div id="adding-saturating-growth" class="section level2">
<h2>Adding saturating growth</h2>
<p>As always, we start with a verbal description of the process we want to model, and then try to express that in some mathematical form. Here what we want to model is “growth of <span class="math inline">\(P\)</span> that is initially exponential, but once <span class="math inline">\(P\)</span> approaches some value, growth should be reduced and eventually go to zero.” Give it a try and see if you can modify the growth term in the model from <span class="math inline">\(gP_t\)</span> to something else such that it captures this process.</p>
<p>There is generally more than one way to translate a certain process into equations. Here is one way it can be done, a very common form. You might have come up with something different. Just make sure it does properly capture the biological process.</p>
<p><span class="math display">\[
P_{t+dt} = P_t + dt ( g P_t(1-\frac{P_t}{P_{max}}) - d_P P_t )
\]</span></p>
<p>By adding the extra term <span class="math inline">\((1-\frac{P_t}{P_{max}})\)</span>, we get a behavior that if <span class="math inline">\(P_t\)</span> is much smaller than <span class="math inline">\(P_{max}\)</span>, this term is close to 1, so we get exponential growth. As <span class="math inline">\(P_t\)</span> approaches <span class="math inline">\(P_{max}\)</span>, the term approaches 0 and thus growth slows down. If you want to explore this model, you can modify the <code>R</code> code above and play with it. You need to introduce the new parameter <span class="math inline">\(P_{max}\)</span> and give it some value, and you need to update the <code>for</code> loop with the new growth term. Everything else can stay the same. You should now find that the exponential growth has been replaced by growth that is initially exponential and then settles down at some level just below <span class="math inline">\(P_{max}\)</span>. The exact level at which you have no more growth (or death) is given if the growth and death terms balance each other, i.e. <span class="math inline">\(g P_t(1-\frac{P_t}{P_{max}}) = d_P P_t\)</span>. You can solve this equation for <span class="math inline">\(P\)</span> to figure out the exact value that <span class="math inline">\(P\)</span> reaches and it which it stays. This is called the steady state value, for obvious reasons.</p>
</div>
<div id="continuous-time-models" class="section level2">
<h2>Continuous time models</h2>
<p>So far, we have looked at a model where the state of the system (the variable <span class="math inline">\(P\)</span> in our example) is updated in discrete time steps. Those steps (<span class="math inline">\(dt\)</span> in our model) are chosen by the modeler. While discrete-time models tend to be easier to grasp initially, they are not used too much for compartmental models like this one, i.e. models that track total populations. The reason for this is that in a large population, you have constantly something going on (someone being born or dying in our example), so it’s often better to describe the system as a continuous model. We’ll come back to this topic of discrete time versus continuous time models. For now, just note that most models like this one are formulated as continuous time model, more specifically as ordinary differential equations (ODE). For a very small time-step, a discrete-time model approaches a continuous-time model. Here are the mathematical manipulations to get from one to the other.</p>
<p>Start with the discrete model</p>
<p><span class="math display">\[
P_{t+dt} = P_t + dt ( g P_t - d_P P_t )
\]</span></p>
<p>Then subtract <span class="math inline">\(P_t\)</span> on both sides and divide by <span class="math inline">\(dt\)</span> to get</p>
<p><span class="math display">\[
\frac{P_{t+dt} - P_t}{dt} =  g P_t - d_P P_t 
\]</span></p>
<p>Now the idea is to make the time step <span class="math inline">\(dt\)</span> very (infinitesimally) small, which leads to the continuous, ODE model formulation</p>
<p><span class="math display">\[
\frac{dP}{dt}  = gP - d_P P
\]</span> Alternative notations are</p>
<p><span class="math display">\[
\frac{dP(t)}{dt}  = gP(t) - d_P P(t)
\]</span> or the shorthand “dot notation”</p>
<p><span class="math display">\[
\dot P  = gP - d_P P
\]</span> The last one is the most common and the one we’ll use.</p>
<p>Note that when you implement a continuous time model on the computer, the computer has to take finite steps. There are numerical methods that choose small time-steps in a smart way such that the continous model behavior is approximated while still being numerically efficient. We’ll be using the <code>deSolve</code> package in R which does that for us. Most of the time, you don’t have to worry about the numerical routine (though occasionally things might go wrong, a first try if something with your model is strange is to see if changing the tolerances for the ODE numerical solver might help).</p>
</div>
<div id="adding-the-immune-response" class="section level2">
<h2>Adding the immune response</h2>
<p>The model above is the simplest possible model, tracking only a single population. Things get more interesting once there are multiple, interacting components. We can extend our model by including an equation for the immune response. We’ll also rename the <span class="math inline">\(P\)</span> variable now to <span class="math inline">\(B\)</span> to indicate specifically that we are modeling bacteria. This does not change any of the model behavior. A very simple model for the dynamics of bacteria and the immune response can be formulated as the following 2 differential equation model:</p>
<p><span class="math display">\[
\begin{aligned}
\textrm{Bacteria} \qquad \dot{B} &amp; = gB(1-\frac{B}{B_{max}}) - d_B B - kBI \\
\textrm{Immune Response} \qquad \dot{I} &amp; =  rBI - d_I I     
\end{aligned}
\]</span> The diagram for this model is this:</p>
<div class="figure" style="text-align: center">
<img src="media/bacteriadiagram.png" alt="Schematic for the simple bacteria model. Solid lines indicate in- and out-flows, dashed lines indicate interactions." width="542" />
<p class="caption">
Schematic for the simple bacteria model. Solid lines indicate in- and out-flows, dashed lines indicate interactions.
</p>
</div>
<p>In this model, some initial population of bacteria grow at rate <span class="math inline">\(g\)</span>, which saturates as they approach some carrying capacity <span class="math inline">\(B_{max}\)</span>. The bacteria also die at some fixed rate <span class="math inline">\(d_B\)</span>. That part of the model is the same as for the one-compartment model above.</p>
<p>In this model, bacteria can also be cleared by the immune response at rate <span class="math inline">\(k\)</span>. The immune response is modeled in a very abstract way with a single equation. As such it doesn’t represent any specific biological component, but can instead be considered as the “total strength of the response.” The immune response is induced and has a per-capita growth proportional to the presence of bacteria at rate <span class="math inline">\(r\)</span>, and a death/decay rate of <span class="math inline">\(d_I\)</span>. Note that as for the virus model, many alternative formulations are possible and the most appropriate one will depend on the specific system and question one wants to study. The model above is a minimal model useful as a conceptual starting point. The model is a type of predator-prey model, which have been heavily studied in ecology. Here, the bacteria are the prey and the immune response is the predator.</p>
<p>Simulating the dynamics of this model for some parameter choices leads to dynamics as shown in the Figure.</p>
<div class="figure" style="text-align: center">
<img src="media/bacteriamodel.png" alt="Dynamics of the simple bacteria model. Note that the oscillations seen in both bacteria load and immune response are rarely observed in actual infections, suggesting that this simple model might not be fully suitable to describe any real infection process." width="2102" />
<p class="caption">
Dynamics of the simple bacteria model. Note that the oscillations seen in both bacteria load and immune response are rarely observed in actual infections, suggesting that this simple model might not be fully suitable to describe any real infection process.
</p>
</div>
<p>Despite the simplicity of this model, one can obtain rather interesting outcomes. You can explore this model further with DSAIRM.</p>
</div>
<div id="simple-viral-infection-model" class="section level2">
<h2>Simple viral infection model</h2>
<p>A simple model that can capture the basic pattern of a viral infection is one that does not include the immune response. The model only considers uninfected and infected cells, as well as free virus. Uninfected cells, <span class="math inline">\(U\)</span>, are created at some rate <span class="math inline">\(n\)</span> and die at some rate <span class="math inline">\(d_U\)</span>. This process happens even in the absence of an infection. If virus is present, uninfected cells can become infected by free virus, <span class="math inline">\(V\)</span>, at rate <span class="math inline">\(b\)</span>. Infected cells, <span class="math inline">\(I\)</span>, produce virus at rate <span class="math inline">\(p\)</span> and die at rate <span class="math inline">\(d_I\)</span>.</p>
<p>Free virus infects cells at rate <span class="math inline">\(b^\)</span>, and is cleared due by the immune response and other mechanisms (e.g. mechanical transport) at rate <span class="math inline">\(d_V\)</span>. The parameter <span class="math inline">\(g\)</span> is there to account for different experimental units (PFU or similar vs number of cells) and make sure all units are consistent (it is always good to check that each term in your model, both on the left and right side, has the same units). For an acute infection, one usually ignores growth and death of uninfected target cells <span class="citation">(Beauchemin and Handel 2011; Smith, McCullers, and Adler 2011)</span>. The diagram, equations, and two simulations of the model, one without and one with natural birth and death of unifected cells, is shown in this figure:</p>
<p><img src="media/nri_review_fig3.png" width="435" style="display: block; margin: auto;" /></p>
</div>
<div id="modeling-the-immune-response" class="section level2">
<h2>Modeling the immune response</h2>
<p>The simple bacteria infection model above included a single equation for the immune response, the virus dynamics model did not include the immune response at all. Obviously, in most infections, the immune response plays an important role and thus will need to be considered. The immune response is very complex, with many different entities (cells, cytokines, etc.) interacting in complicated ways. As such, being able to model the immune response in full detail is not possible. The modeler will have to decide which components are important for a given scenario and question and include those, while still trying to keep the model at a manageable level of complexity (see further comments on that point below). Even including only a few immune response components quickly leads to fairy complex models. We illustrate this by including a few immune response components into the acute virus infection model. Specifically, we will add one equation to model the innate immune response, two equations for B-cells and antibodies, and one equation for CD8 T-cells.</p>
<p>The model works as follows. Uninfected cells, <span class="math inline">\(U\)</span>, become infected by free virus, <span class="math inline">\(V\)</span>, at rate <span class="math inline">\(b\)</span>. Infected cells, <span class="math inline">\(I\)</span>, produce virus at rate <span class="math inline">\(p\)</span> and die at rate <span class="math inline">\(d_I\)</span>. Free virus infects cells at rate <span class="math inline">\(b^{&#39;}\)</span>, is cleared by antibodies at rate <span class="math inline">\(k^{&#39;}_{A}\)</span> or removed due to other mechanisms (e.g. mechanical transport) at rate <span class="math inline">\(d_V\)</span>. Note that <span class="math inline">\(b^{&#39;}\)</span> and <span class="math inline">\(k^{&#39;}_{A}\)</span> differ from parameters <span class="math inline">\(b\)</span> and <span class="math inline">\(k_{A}\)</span> to account for experimental units (PFU for virus and titer for antibody). A (generic/abstract) innate response, <span class="math inline">\(F\)</span>, is assumed to be produced and decays at rates <span class="math inline">\(p_F\)</span> and <span class="math inline">\(d_F\)</span> in the absence of an infection. Presence of virus leads to an increase in the innate response, with growth saturating at a maximum rate <span class="math inline">\(g_F\)</span>. The maximum level the innate response can reach is given by the parameter <span class="math inline">\(F_{\textrm{max}}\)</span>. The action of the innate response is twofold. First, it can directly counteract the virus by, for instance, reducing virus production rate of infected cells. In our model, the strength of production suppression is determined by the parameter <span class="math inline">\(s_F\)</span>. The second action of the innate response is to induce the adaptive response. The dynamics of activated B cells is modeled as increasing in a sigmoidal manner dependent on both the amount of virus (antigen) and innate response present, with a maximum at rate <span class="math inline">\(g_B\)</span>. Again, since we are focusing on the short-term dynamics of the system, B-cell decay is ignored. In the absence of an infection, B-cells are set to an arbitrary level of 1. B-cells produce antibodies at rate <span class="math inline">\(r_A\)</span>. Antibodies decay naturally at rate <span class="math inline">\(d_A\)</span> and bind to and remove free virus at rate <span class="math inline">\(k_A\)</span>. Finally, T-cells are induced proportional to virus/antigen at rate <span class="math inline">\(a\)</span> and then grow exponentially at rate <span class="math inline">\(g_T\)</span>. Those T-cells kill infected cells at rate <span class="math inline">\(k_T\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
\textrm{Uninfected cells} \qquad \dot{U} &amp; = - bUV \\
\textrm{Infected cells} \qquad \dot{I} &amp; =  bUV - d_I I -k_T T I\\     
\textrm{Virus} \qquad  \dot{V} &amp; =  \frac{p}{1+s_F F}I - d_V V - k^{&#39;}_{A}AV -  b^{&#39;} UV\\ 
\textrm{Innate response} \qquad \dot{F} &amp; = p_F - d_F F +  \frac{V}{V+h_V} g_F (F_{max} - F)  \\
\textrm{B cells} \qquad \dot{B} &amp; =  \frac{F V}{FV+h_F} g_B B  \\
\textrm{Antibodies} \qquad \dot{A} &amp; =   r_A B  - d_A A  - k_{A}AV \\
\textrm{T-cells} \qquad  \dot{T} &amp; = aV + g_T T
\end{aligned}
\]</span></p>
<p>Simulating the dynamics of this model for some parameter choices leads to dynamics as shown in Figure @ref(fig:immunemodel).</p>
<div class="figure">
<img src="media/immunemodel.png" alt="Dynamics of the model with innate and adaptive immunity for one choice of parameters." width="2102" />
<p class="caption">
Dynamics of the model with innate and adaptive immunity for one choice of parameters.
</p>
</div>
<p>Note that different parameter choices lead to different dynamics. Parameters should be chosen based on what is known about the system. Bigger models tend to have more parameters, each of which needs to be specified. For systems that are not too well studied, obtaining reliable parameter estimates can be a challenge.</p>
<p>While the model is still fairly abstract, it is arguably more realistic comapred to the virus infection model without the immune response. The downside is that this model is more complex. The trade-offs of model simplicity versus complexity are further discussed below. Also note that there are many different ways one could map the detailed dynamics of the immune response into a set of equations. The above example is one way of doing it, but by no means the only one. It is up to the modeler, based on their understanding of the biology of the system, to decide how to implement the model. An interesting discussion and evaluation of different models that were used to simulate influenza infections can be found in <span class="citation">(Dobrovolny et al. 2013)</span>.</p>
</div>
</div>
<div id="practice" class="section level1">
<h1>Practice</h1>
<p>You can further explore these models using DSAIRM.</p>
</div>
<div id="further-materials" class="section level1">
<h1>Further materials</h1>
<ul>
<li><p>Our recent review <a href="https://handelgroup.uga.edu/publication/2020-handel-natrevimm/">Simulation Modelling for Immunologists</a> discusses those simple models.</p></li>
<li><p>The paper <a href="https://www.nature.com/articles/nri700">Modelling Viral and Immune System Dynamics</a> by Alan Perelson is another nice introduction focusing on virus models and explaining a few different models.<br />
</p></li>
<li><p>The paper <a href="https://www.nature.com/articles/nri1550">The role of models in understanding CD8+ T-cell memory</a> by Antia et al. introduces a few simple models for T-cell dynamics.</p></li>
</ul>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-beauchemin11" class="csl-entry">
Beauchemin, Catherine A A., and Andreas Handel. 2011. <span>“A Review of Mathematical Models of Influenza <span>A</span> Infections Within a Host or Cell Culture: Lessons Learned and Challenges Ahead.”</span> <em>BMC Public Health</em> 11 Suppl 1 (Suppl 1): S7. <a href="https://doi.org/10.1186/1471-2458-11-S1-S7">https://doi.org/10.1186/1471-2458-11-S1-S7</a>.
</div>
<div id="ref-dobrovolny2013c" class="csl-entry">
Dobrovolny, Hana M., Micaela B. Reddy, Mohamed A. Kamal, Craig R. Rayner, and Catherine A. A. Beauchemin. 2013. <span>“Assessing <span>Mathematical Models</span> of <span>Influenza Infections Using Features</span> of the <span>Immune Response</span>.”</span> <em>PLOS ONE</em> 8 (2): e57088. <a href="https://doi.org/10.1371/journal.pone.0057088">https://doi.org/10.1371/journal.pone.0057088</a>.
</div>
<div id="ref-smith11" class="csl-entry">
Smith, Amber M, Jonathan A McCullers, and Frederick R Adler. 2011. <span>“Mathematical Model of a Three-Stage Innate Immune Response to a Pneumococcal Lung Infection.”</span> <em>Journal of Theoretical Biology</em> 276 (1): 106–16. <a href="https://doi.org/10.1016/j.jtbi.2011.01.052">https://doi.org/10.1016/j.jtbi.2011.01.052</a>.
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
