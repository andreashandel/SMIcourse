---
title: Using Models for Exploration
subtitle: ""
author: Andreas Handel
institute: "University of Georgia"
date: "`r file.mtime(knitr::current_input())`"
#bibliography: ../media/SMICourse.bib
output: 
  html_document:
    toc_depth: 3
---

```{r, echo = FALSE}
library(emo)
```


# Overview
This document describes how to use simulation models to explore systems.

# Learning Objectives
* Know when and why to use simulation models for system exploration.
* Be able to implement simple model exploration simulations.



# Introduction 
At the early stages of trying to gain a fairly basic understanding of the behavior of a system, one can build simple mechanistic models and explore how interactions between model components (and thus components of the real system) impact observed patterns. Using models in this way provides a quick and cheap way to gain some intuition of how a system functions. For understanding purposes, one generally tries to keep models simple.



# How to use models for exploration
At the very first stage, as you are building your model, you will run it and look at the behavior of some, ideally all, model components (your variables). This will produce time-series plots, i.e. you will plot the behavior of the model components as a function of time. Doing so is vital to test your model, debug your code, and make sure everything is working as expected. Once you are confident your model and code work as expected, you can move on to the actual analysis and exploration of your system. This can also be done with time-series plots. Let's say you want to know how the model behaves for a set of parameters you consider most reasonable. You set the model parameters to those values, run the model, and report your results. If you want to explore scenarios, e.g. by having some parameter turned off (set to zero) and then turned on, 

* So far, we looked at the dynamics (time-series) of our models for specific parameter values.
* Often, we are not mainly interested in the time series, but instead some more specific quantity, e.g. pathogen peak, AUC, virus load at steady state, etc.
* We usually want to to know how such outcome(s) of interest vary with some parameter(s).
* What do we need to do to answer such questions?



## Model Exploration
1. Choose some parameter values.
2. Run the simulation model.
3. Record quantities/outcomes of interest.
4. Choose another set of parameter values (usually we only vary one at a time).
5. Repeat steps 2-4 until you got all parameter-outcome pairs of interest.
6. Report (e.g. plot) your findings.

```{r predictexample,  fig.cap='', echo=FALSE, out.width = '50%' , fig.align='center'}
knitr::include_graphics("../images/predictexample.png")
```


## Model Exploration Examples
```{r tbexample,  echo=FALSE, out.width="70%", fig.align='center'}
knitr::include_graphics("../images/tbfig.png")
```

Minimum TB parasite density as function of rates of transition to dormant (f) and activated (g) state. [Antia et al (1996), Proc Royal Soc B](http://rspb.royalsocietypublishing.org/content/263/1368/257)

## Model Exploration Examples
```{r malariaexample,  echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("../images/malariafig.png")
```

Peak (I~PK~) and total (I~INT~) malaria parasite load as function of binding affinity $\xi$ and immune responsse activation threshold, A~th~. [McQueen & McKenzie (2008) PLoS Comp Bio](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1000149)



## Model Exploration Examples
```{r fluexample,  echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("../images/stickiness.png")
```
Virus fitness as function of virion binding (k~+~) and release (k~-~) rates. [Handel et al (2014) Proc Royal Soc Interface](http://rsif.royalsocietypublishing.org/content/11/92/20131083).


## Model Exploration with DSAIRM
* We could do the model exploration by hand through the DSAIRM GUI. 
* We could automate it by writing R code that loops over parameters and repeatedly calls the underlying model (see e.g. 'Level 2' in the DSAIRM vignette).
* I wrote one app that does this for you and you can explore the results through a shiny app.
* We'll look at the Basic Bacteria model and investigate how 4 outcomes of interest, namely Bacteria and Immune Response peaks and levels at steady state, depend on various parametes of the model.
* Open and go through the "Model Exploration" app in DSAIRM.





# Further materials

* Our recent review [Simulation Modelling for Immunologists](https://handelgroup.uga.edu/publication/2020-handel-natrevimm/) provides a general introduction to the kinds of simulation models we will be discussing in this course. If you haven't done yet, please read the paper. 

